# 超级方块 - 项目理解文档

## 一、项目基础信息

| 项目属性 | 说明 |
|---------|------|
| 游戏名称 | 超级方块 |
| 开发框架 | React Native |
| 棋盘大小 | 9×9 |
| 方块颜色 | 7种 |
| 平台支持 | iOS / Android |

---

## 二、游戏规则（已确认）

### 2.1 核心玩法

#### 移动机制
- **方块移动**：玩家选择一个方块，将其从原位置移动到目标空位
- **路径限制**：移动必须通过棋盘上连续的空格，路径上不能有其他方块阻挡
- **路径计算**：需要使用 BFS（广度优先搜索）算法计算可到达的位置
- **步数无限制**：只要路径上有空位就可以移动，不限移动步数

```
示例：方块 A 要移动到目标位置
┌─┬─┬─┐      ┌─┬─┬─┐
│A│█│ │  →  │ │█│ │  ✓ 可行
├─┼─┼─┤      ├─┼─┼─┤
│█│ │ │      │█│A│ │
└─┴─┴─┘      └─┴─┴─┘

┌─┬─┬─┐      ┌─┬─┬─┐
│A│█│ │  →  │ │█│ │  ✗ 不可行
├─┼─┼─┤      ├─┼─┼─┤  （路径被阻挡）
│█│█│ │      │█│█│A│
└─┴─┴─┘      └─┴─┴─┘
```

#### 消除规则
- **消除条件**：5个或更多相同颜色的方块相连即可消除
- **相连方向**：垂直、水平、斜向（8个方向）
- **消除后**：被消除的方块位置变为空位

```
相连示例（X 表示同色方块）：
8个方向：
  ┌───┬───┬───┐
  │↖ │ ↑ │ ↗ │
  ├───┼───┼───┤
  │← │ ● │ → │  ● 是起点
  ├───┼───┼───┤
  │↙ │ ↓ │ ↘ │
  └───┴───┴───┘

横向相连：
┌─┬─┬─┬─┬─┐
│X│X│X│X│X│  ✓ 5个横向相连
└─┴─┴─┴─┴─┘

纵向相连：
┌─┐
│X│  ✓ 5个纵向相连
├─┤
│X│
├─┤
│X│
├─┤
│X│
├─┤
│X│
└─┘

斜向相连：
┌─┬─┬─┬─┬─┐
│X│ │ │ │ │
├─┼─┼─┼─┼─┤
│ │X│ │ │ │
├─┼─┼─┼─┼─┤
│ │ │X│ │ │  ✓ 5个斜向相连
├─┼─┼─┼─┼─┤
│ │ │ │X│ │
├─┼─┼─┼─┼─┤
│ │ │ │ │X│
└─┴─┴─┴─┴─┘
```

#### 分数规则
- **5个方块消除**：50分
- **6个方块消除**：60分
- **每增加1个方块**：+10分
- **计算公式**：分数 = (方块数量 - 4) × 10

```
分数示例：
5个方块 → (5-4) × 10 = 10分  ❌ 等等，应该是 50分
6个方块 → (6-4) × 10 = 20分  ❌ 等等，应该是 60分

让我重新理解：
5个方块 → 50分
6个方块 → 60分
7个方块 → 70分
8个方块 → 80分
9个方块 → 90分

修正公式：分数 = 方块数量 × 10
```

#### 新方块生成规则
- **初始生成**：游戏开始时随机生成 5 个方块
- **后续生成**：每次随机生成 2-3 个方块
- **生成条件**：仅在玩家移动后**没有消除**时才生成新方块
- **生成位置**：棋盘上随机空位（必须是空位置，上方不能有方块）
- **生成颜色**：随机颜色（7种颜色之一）

#### 游戏结束条件
- **失败条件**：当棋盘上没有足够空位置来放置新生成的方块时，游戏结束
- **计分模式**：单人游戏，目标是获得尽可能高的分数

#### 连续操作规则
- **有消除**：如果玩家移动后发生了方块消除，玩家可以继续操作（不生成新方块）
- **无消除**：如果玩家移动后没有方块消除，才生成 2-3 个新方块

```
游戏流程：
玩家移动方块
    ↓
检测消除
    ├─ 有消除：清除方块，加分 → 玩家可以继续操作
    └─ 无消除：生成 2-3 个新方块 → 检测游戏结束
```

### 2.2 游戏策略要素

根据你提供的文字描述，游戏涉及以下策略：

1. **局部 vs 全局**
   - 不能过度专注于某个局部区域
   - 需要放眼整个棋盘寻找最佳机会

2. **放弃的艺术**
   - 当某个区域明显被"针对"时，果断放弃
   - 避免因赌气而破坏整体局面

3. **路径规划**
   - 移动方块前需要规划路径
   - 避免将某个区域"封死"，导致后续无法移动

4. **创造机会**
   - 通过主动创造消除机会来破局
   - 但需注意不要因此封死其他路径
   - 每次成功消除可以继续操作，这是刷分的关键

5. **连击策略**
   - 利用"有消除可继续操作"的规则
   - 一次布局可以触发连续多次消除
   - 这是最高的得分技巧

---

## 三、技术架构设计

### 3.1 项目结构

```
fangkuai/
├── src/
│   ├── components/
│   │   ├── GameBoard.tsx       # 9×9 棋盘组件
│   │   ├── Block.tsx           # 单个方块组件
│   │   ├── PathHighlight.tsx   # 可移动路径高亮
│   │   ├── ScoreBoard.tsx      # 分数显示
│   │   └── Controls.tsx        # 游戏控制（开始/暂停/重置）
│   ├── game/
│   │   ├── GameLogic.ts        # 游戏核心逻辑
│   │   ├── BoardState.ts       # 棋盘状态管理
│   │   ├── PathFinder.ts       # 路径计算（BFS）
│   │   ├── BlockMatcher.ts     # 消除检测（8方向）
│   │   └── ScoreCalculator.ts  # 分数计算
│   ├── types/
│   │   ├── Block.ts            # 方块类型定义
│   │   ├── Board.ts            # 棋盘类型定义
│   │   └── GameState.ts        # 游戏状态类型
│   ├── utils/
│   │   ├── BlockColor.ts       # 方块颜色定义
│   │   └── Helpers.ts          # 辅助函数
│   ├── screens/
│   │   ├── GameScreen.tsx      # 游戏主界面
│   │   └── HomeScreen.tsx      # 首页
│   ├── styles/
│   │   └── Theme.ts            # 主题样式
│   └── App.tsx
├── android/                    # Android 原生代码
├── ios/                        # iOS 原生代码
└── package.json
```

### 3.2 数据结构设计

#### 方块类型
```typescript
interface Block {
  id: string;           // 唯一标识
  colorIndex: number;   // 0-6 对应 7 种颜色
  row: number;          // 行位置 (0-8)
  col: number;          // 列位置 (0-8)
}
```

#### 棋盘状态
```typescript
type Board = (Block | null)[][];  // 9×9 二维数组，null 表示空位
```

#### 游戏状态
```typescript
interface GameState {
  board: Board;                      // 棋盘状态
  score: number;                     // 当前分数
  selectedBlock: Block | null;       // 当前选中的方块
  reachablePositions: Position[];    // 可移动的位置列表
  gameOver: boolean;                 // 游戏是否结束
  highScore: number;                 // 最高分
  combo: number;                     // 连续消除次数
}
```

### 3.3 核心算法

#### 路径计算（BFS）
```typescript
/**
 * 计算从起点到终点的路径是否可行
 * 使用 BFS 算法查找最短路径
 */
function findPath(
  board: Board,
  from: Position,
  to: Position
): Position[] | null {
  // 实现细节...
}
```

#### 消除检测（8方向）
```typescript
/**
 * 检测棋盘上所有可消除的方块组合
 * 支持 8 个方向：上、下、左、右、左上、右上、左下、右下
 */
function findMatches(board: Board): Block[][] {
  // 实现细节...
}
```

#### 分数计算
```typescript
/**
 * 计算消除得分
 * 公式：分数 = 方块数量 × 10
 */
function calculateScore(blockCount: number): number {
  return blockCount * 10;
}
```

#### 游戏结束检测
```typescript
/**
 * 检测是否还能放置新方块
 */
function checkGameOver(board: Board, newBlockCount: number): boolean {
  const emptyCells = countEmptyCells(board);
  return emptyCells < newBlockCount;
}
```

### 3.4 7种方块颜色

```typescript
export const BLOCK_COLORS = [
  '#FF6B6B',  // 红色 - Red
  '#4ECDC4',  // 青色 - Teal
  '#45B7D1',  // 蓝色 - Blue
  '#96CEB4',  // 绿色 - Green
  '#FFEEAD',  // 黄色 - Yellow
  '#FF9AA2',  // 粉色 - Pink
  '#9B59B6'   // 紫色 - Purple
] as const;

export type BlockColorIndex = 0 | 1 | 2 | 3 | 4 | 5 | 6;
```

### 3.5 状态管理

使用 React Hooks：
- `useReducer` 管理复杂的游戏状态
- `useState` 管理简单的 UI 状态
- `useEffect` 处理副作用（动画、音效等）

### 3.6 完整交互流程

```
游戏开始
    ↓
随机生成 5 个初始方块
    ↓
玩家点击方块
    ↓
高亮可移动的位置（BFS 计算路径）
    ↓
玩家点击目标空位
    ↓
执行移动（动画过渡）
    ↓
检测消除（8方向，≥5个同色）
    ├─ 有消除：
    │   ├─ 清除方块
    │   ├─ 计算分数
    │   ├─ 增加连击数
    │   └─ 玩家可以继续操作
    └─ 无消除：
        ├─ 重置连击数
        ├─ 生成 2-3 个新方块
        ├─ 检测游戏结束
        │   ├─ 未结束：继续游戏
        │   └─ 结束：显示结束界面
        └─ 玩家可以继续操作
```

---

## 四、开发计划

### 阶段 1：基础框架搭建
1. 初始化 React Native 项目
2. 设计棋盘 UI（9×9 网格）
3. 实现方块组件和颜色渲染

### 阶段 2：核心游戏逻辑
1. 实现棋盘数据结构
2. 实现 BFS 路径计算（支持任意步数）
3. 实现方块移动功能
4. 实现消除检测（8方向，≥5个同色）
5. 实现分数计算

### 阶段 3：游戏循环完善
1. 实现初始方块生成（5个）
2. 实现新方块生成（2-3个，随机空位）
3. 实现连续操作规则（有消除可继续）
4. 实现游戏结束检测
5. 添加动画效果

### 阶段 4：UI 和体验优化
1. 添加音效和震动反馈
2. 实现路径高亮显示
3. 添加连击提示
4. 添加游戏暂停/继续功能
5. 实现最高分记录

---

## 五、规则总结

| 规则项 | 具体说明 |
|-------|---------|
| 棋盘大小 | 9×9 |
| 方块颜色 | 7种 |
| 移动规则 | 沿空格路径移动，无步数限制 |
| 消除条件 | ≥5个同色方块相连 |
| 相连方向 | 8个方向（上、下、左、右、斜向） |
| 初始方块 | 随机生成 5 个 |
| 新方块生成 | 每次移动后无消除时生成 2-3 个 |
| 生成位置 | 棋盘随机空位 |
| 分数计算 | 方块数量 × 10 分 |
| 连续操作 | 有消除可继续，无消除生成新方块 |
| 游戏结束 | 无足够空位放置新方块 |
| 游戏模式 | 单人分数模式 |

---

## 六、下一步

规则已全部确认，准备开始开发！

开始顺序：
1. 创建 React Native 项目基础框架
2. 实现核心游戏逻辑
3. 开发 UI 界面
